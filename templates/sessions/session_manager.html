{% extends "dashboard.html" %}
 
{% block main %}

 <div class="main-view-top">

    <!-- Quick Stats -->
    <div class="sessions-tabs">
        <button class="tab-btn active" onclick="sessionTab('upcoming')">Upcoming Sessions</button>
        <button class="tab-btn" onclick="sessionTab('completed')">Completed Sessions</button>
        <button class="tab-btn" onclick="sessionTab('cancelled')">Cancelled Sessions</button>
    </div>
<style>
    #upcoming, #completed, #cancelled{
        overflow-y: scroll;
    }
    .btn-sm{
        min-width:100%;
    }
</style>
    <div id="upcoming" class="tab-content active">
        <div class="sessions-list">
            {% for session in sessions %}
            <div class="session-card">
                <div class="session-header">
                    <div class="session-time">
                        <div class="session-date">Today</div>
                        <div class="session-hour">{{session.start_time}}</div>
                    </div>
                    <div class="session-status {{session.status}}"> {{session.status}}</div>
                </div>
                <div class="session-details">
                    <div class="session-student">
                        <div class="student-avatar"><img src="/static{{session.base_session.tutor.avatar.url}}" alt="{{session.base_session.tutor.username}}"></div>
                        <div class="student-info">
                            <h4>{{session.base_session.tutor.username}}</h4>
                            <p>{{session.topic}}</p>
                        </div>
                    </div>
                    <div class="session-info">
                        <div class="info-item">
                            <span class="info-label">Subject:</span>
                            <span class="info-value">{{session.base_session.subject_name}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Type:</span>
                            <span class="info-value">{{session.session_type}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value">{{session.base_session.session_duration}}</span>
                        </div>
                    </div>
                </div> {% if request.user.role == 'tutor' %}
                    
                    <div class="session-actions">
                        {% if session.status == 'up_comming' %}
                            {% if session.session_type == 'online' %}
                                <a href="{% url 'create_virtual_class'  session.id %}"><button  class="btn-sm btn-primary">Create Room</button> </a>
                            {% else %}
                                <a href="{% url 'check_in_out'  session.id %}"><button  class="btn-sm btn-primary">Start Class</button> </a>

                            {% endif %}
                        {% else %}
                    <a  ><button disabled class="btn-sm btn-primary">Start Class</button> </a>
                    
                        {% endif %}

                        <button class="btn-sm btn-secondary">Message {{session.base_session.student.username}}</button>
                         <a href="{% url 'session_reschedule' session.id %}">
                            <button class="btn-sm btn-outline"> Reschedule </button>
                        </a>
                    </div>
                    {% else %}
                    <div class="session-actions">
                        {% if session.status == 'up_comming' %}
                        <a href="{% url 'join_virtual_class' session.id %}"><button  class="btn-sm btn-primary">Join Class</button> </a>
                         {% endif %}

                        <button class="btn-sm btn-secondary">Message {{session.base_session.tutor.username}}</button>
                        <a href="{% url 'session_reschedule' session.id %}">
                            <button class="btn-sm btn-outline "> Reschedule </button>
                        </a>
                    </div>
                    {% endif %} 
            </div>
            {% empty %}
            <div class="sessions-list">
            <div class="empty-state">
                <div class="empty-icon">ðŸ“…</div>
                <h3>No Cancelled Sessions</h3>
                <p>You don't have any cancelled sessions.</p>
            </div>
        </div>
            {% endfor %}
             
        </div>
    </div>

    <div id="completed" class="tab-content">
        <div class="sessions-list">
             {% for session in completed_sessions %}
            <div class="session-card">
                <div class="session-header">
                    <div class="session-time">
                        <div class="session-date">Today</div>
                        <div class="session-hour">{{session.start_time}}</div>
                    </div>
                    <div class="session-status {{session.status}}">{{session.status}}</div>
                </div>
                <div class="session-details">
                    <div class="session-student">
                        <div class="student-avatar"><img src="/static{{session.base_session.tutor.avatar.url}}" alt="{{session.base_session.tutor.username}}"></div>
                        <div class="student-info">
                            <h4>{{session.base_session.tutor.username}}</h4>
                            <p>{{session.topic}}</p>
                        </div>
                    </div>
                    <div class="session-info">
                        <div class="info-item">
                            <span class="info-label">Subject:</span>
                            <span class="info-value">{{session.base_session.subject_name}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Type:</span>
                            <span class="info-value">{{session.session_type}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value">{{session.base_session.session_duration}}</span>
                        </div>
                    </div>
                </div> {% if request.user.role == 'tutor' %}
                    
                   <div class="session-actions">
                        <a href="{% url 'create_virtual_class'  session.id %}"><button  disabled class="btn-sm btn-primary">Start Class</button> </a>
                        <button disabled class="btn-sm btn-secondary">Message {{session.base_session.student.username}}</button>
                         <a href="{% url 'session_reschedule' session.id %}">
                            <button disabled class="btn-sm btn-outline"> Reschedule </button>
                        </a>
                    </div>
                    {% else %}
                    <div class="session-actions">
                        <a href="{% url 'join_virtual_class' session.id %}"><button  class="btn-sm btn-primary">Join Class</button> </a>
                        <button disabled class="btn-sm btn-secondary">Message {{session.base_session.tutor.username}}</button>
                        <a href="{% url 'session_reschedule' session.id %}">
                            <button disabled class="btn-sm btn-outline "> Reschedule </button>
                        </a>
                    </div>
                    {% endif %} 
            </div>
            {% empty %}
            <div class="sessions-list">
            <div class="empty-state">
                <div class="empty-icon">ðŸ“…</div>
                <h3>No Cancelled Sessions</h3>
                <p>You don't have any cancelled sessions.</p>
            </div>
        </div>
            {% endfor %}
        </div>
    </div>

    <div id="cancelled" class="tab-content">
        <div class="sessions-list">
             {% for session in canceld_sessions %}
            <div class="session-card">
                <div class="session-header">
                    <div class="session-time">
                        <div class="session-date">Today</div>
                        <div class="session-hour">{{session.start_time}}</div>
                    </div>
                    <div class="session-status {{session.status}}">{{session.status}}</div>
                </div>
                <div class="session-details">   
                    <div class="session-student">
                        <div class="student-avatar"><img src="/static{{session.base_session.tutor.avatar.url}}" alt="{{session.base_session.tutor.username}}"></div>
                        <div class="student-info">
                            <h4>{{session.base_session.tutor.username}}</h4>
                            <p>{{session.topic}}</p>
                        </div>
                    </div>
                    <div class="session-info">
                        <div class="info-item">
                            <span class="info-label">Subject:</span>
                            <span class="info-value">{{session.base_session.subject_name}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Type:</span>
                            <span class="info-value">{{session.session_type}}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span class="info-value">{{session.base_session.session_duration}}</span>
                        </div>
                    </div>
                </div> {% if request.user.role == 'tutor' %}
                    
                    <div class="session-actions">
                        <button disabled class="btn-sm btn-secondary">Message {{session.base_session.student.username}}</button>
                         <a href="{% url 'session_reschedule' session.id %}">
                            <button disabled class="btn-sm btn-outline"> Reschedule </button>
                        </a>
                    </div>
                    {% else %}
                    <div class="session-actions">
                        <button disabled class="btn-sm btn-secondary">Message {{session.base_session.tutor.username}}</button>
                        <a href="{% url 'session_reschedule' session.id %}">
                            <button disabled class="btn-sm btn-outline "> Reschedule </button>
                        </a>
                    </div>
                    {% endif %} 
            </div>
            {% empty %}
            <div class="sessions-list">
            <div class="empty-state">
                <div class="empty-icon">ðŸ“…</div>
                <h3>No Cancelled Sessions</h3>
                <p>You don't have any cancelled sessions.</p>
            </div>
        </div>
            {% endfor %}
        </div>
    </div>

</div>
<script>
       function sessionTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
</script>
{% endblock main %}
